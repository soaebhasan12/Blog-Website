{% extends 'roorkee360/base.html' %}
{% load static %}

{% block title %}{{ article.title }} - Roorkee360{% endblock %}

{% block meta_description %}{{ article.meta_description|default:article.excerpt|default:article.subtitle|truncatewords:20 }}{% endblock %}

{% block meta_keywords %}{{ article.meta_keywords }}{% endblock %}

{% block og_title %}{{ article.title }}{% endblock %}
{% block og_description %}{{ article.excerpt|default:article.subtitle|truncatewords:30 }}{% endblock %}
{% block og_image %}{% if article.featured_image %}{{ article.featured_image.url }}{% else %}{% static 'images/logo-og.png' %}{% endif %}{% endblock %}

{% block body_class %}article-detail-page{% endblock %}

{% block extra_css %}
    <style>
        .article-detail-page {
            background-color: var(--bg-primary);
        }

        .article-title {
            line-height: 1.2;
            color: var(--text-primary);
        }

        .article-subtitle {
            font-size: 1.3rem;
            font-weight: 400;
            color: var(--text-secondary);
        }

        .article-content {
            font-size: 1.1rem;
            line-height: 1.8;
            color: var(--text-primary);
        }

        .article-content p {
            margin-bottom: 1.5rem;
        }

        .article-content h2,
        .article-content h3,
        .article-content h4 {
            margin-top: 2rem;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .article-content img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 1.5rem 0;
        }

        .article-content blockquote {
            border-left: 4px solid var(--accent-color);
            padding-left: 1.5rem;
            margin: 1.5rem 0;
            font-style: italic;
            color: var(--text-secondary);
        }

        .article-meta {
            font-size: 0.9rem;
        }

        .author-bio {
            border: 1px solid var(--border-color);
            border-radius: 12px;
        }

        .comment-item {
            border-color: var(--border-color) !important;
        }

        .comment-form {
            background-color: var(--bg-secondary);
            padding: 2rem;
            border-radius: 12px;
            margin-top: 2rem;
        }

        @media (max-width: 768px) {
            .article-title {
                font-size: 2rem;
            }
            
            .article-subtitle {
                font-size: 1.1rem;
            }
            
            .article-content {
                font-size: 1rem;
            }
            
            .share-buttons {
                flex-wrap: wrap;
                gap: 0.5rem;
            }
            
            .share-buttons .btn {
                flex: 1;
                min-width: 120px;
            }
        }


        {% comment %} Comment Section Styling {% endcomment %}
        .avatar-circle {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-color), #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }

        .comment-item {
            transition: background-color 0.3s ease;
            padding: 1rem;
            border-radius: 8px;
        }

        .comment-item:hover {
            background-color: var(--bg-secondary);
        }

        .comment-author {
            font-weight: 600;
            color: var(--text-primary);
        }

        .comment-text {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .comment-form {
            background-color: var(--bg-secondary);
            padding: 2rem;
            border-radius: 12px;
            margin-top: 2rem;
        }

        .form-control.is-invalid {
            border-color: #dc3545;
        }

        .invalid-feedback {
            color: #dc3545;
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }

        /* Animation for new comments */
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .comment-item {
            animation: slideInUp 0.5s ease;
        }

        /* Loading state for submit button */
        .btn-loading {
            position: relative;
            pointer-events: none;
        }

        .btn-loading::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            top: 50%;
            left: 50%;
            margin-left: -8px;
            margin-top: -8px;
            border: 2px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spinner 0.6s linear infinite;
        }

        @keyframes spinner {
            to { transform: rotate(360deg); }
        }
    </style>
{% endblock %}

{% block content %}
    <!-- Breadcrumb Navigation -->
    <nav aria-label="breadcrumb" class="container py-3">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'news:home' %}" class="text-decoration-none">Home</a></li>
            <li class="breadcrumb-item"><a href="{% url 'news:category' article.category.name %}" class="text-decoration-none">{{ article.category.display_name }}</a></li>
            <li class="breadcrumb-item active" aria-current="page">{{ article.title|truncatewords:5 }}</li>
        </ol>
    </nav>


    <!-- Main Article Content -->
    <article class="container py-4">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <!-- Article Header -->
                <header class="article-header mb-4">
                    <div class="d-flex align-items-center mb-3">
                        <span class="badge bg-primary me-2">{{ article.category.display_name }}</span>
                        {% if article.is_breaking %}
                        <span class="badge bg-danger me-2">Breaking</span>
                        {% endif %}
                        {% if article.is_featured %}
                        <span class="badge bg-warning text-dark">Featured</span>
                        {% endif %}
                    </div>
                    
                    <h1 class="article-title display-5 fw-bold mb-3">{{ article.title }}</h1>
                    
                    {% if article.subtitle %}
                    <h2 class="article-subtitle lead text-muted mb-4">{{ article.subtitle }}</h2>
                    {% endif %}
                    
                    <div class="article-meta d-flex flex-wrap align-items-center gap-3 mb-4">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-user-circle me-2 text-muted"></i>
                            <span class="text-muted">By {{ article.author.get_full_name|default:article.author.username }}</span>
                        </div>
                        <div class="d-flex align-items-center">
                            <i class="fas fa-calendar-alt me-2 text-muted"></i>
                            <span class="text-muted">{{ article.published_at|date:"F j, Y" }}</span>
                        </div>
                        <div class="d-flex align-items-center">
                            <i class="fas fa-clock me-2 text-muted"></i>
                            <span class="text-muted" id="reading-time">Calculating...</span>
                        </div>
                        <div class="d-flex align-items-center">
                            <i class="fas fa-eye me-2 text-muted"></i>
                            <span class="text-muted">{{ article.views_count }} views</span>
                        </div>
                    </div>
                </header>

                <!-- Featured Image -->
                {% if article.featured_image %}
                <figure class="article-featured-image mb-4">
                    <img src="{{ article.featured_image.url }}" alt="{{ article.featured_image_alt|default:article.title }}" class="img-fluid rounded-3 w-100" style="max-height: 500px; object-fit: cover;">
                    {% if article.featured_image_caption %}
                    <figcaption class="text-center text-muted mt-2 small">{{ article.featured_image_caption }}</figcaption>
                    {% endif %}
                </figure>
                {% endif %}

                <!-- Article Content -->
                <div class="article-content mb-5">
                    {{ article.content|linebreaks }}
                </div>

                <!-- Tags -->
                {% if article.tags.all %}
                <div class="article-tags mb-5">
                    <h6 class="mb-3"><i class="fas fa-tags me-2"></i>Tags</h6>
                    <div class="d-flex flex-wrap gap-2">
                        {% for tag in article.tags.all %}
                        <span class="badge bg-secondary text-white">{{ tag.name }}</span>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- Social Sharing -->
                <div class="article-sharing mb-5">
                    <h6 class="mb-3">Share this article</h6>
                    <div class="d-flex gap-2">
                        <button class="btn btn-outline-primary btn-sm share-btn" data-platform="facebook" data-url="{{ request.build_absolute_uri }}" data-title="{{ article.title }}">
                            <i class="fab fa-facebook-f me-2"></i>Facebook
                        </button>
                        <button class="btn btn-outline-info btn-sm share-btn" data-platform="twitter" data-url="{{ request.build_absolute_uri }}" data-title="{{ article.title }}">
                            <i class="fab fa-twitter me-2"></i>Twitter
                        </button>
                        <button class="btn btn-outline-danger btn-sm share-btn" data-platform="whatsapp" data-url="{{ request.build_absolute_uri }}" data-title="{{ article.title }}">
                            <i class="fab fa-whatsapp me-2"></i>WhatsApp
                        </button>
                        <button class="btn btn-outline-dark btn-sm copy-link-btn" data-url="{{ request.build_absolute_uri }}">
                            <i class="fas fa-link me-2"></i>Copy Link
                        </button>
                    </div>
                </div>

                <!-- Author Bio -->
                <div class="author-bio card mb-5">
                    <div class="card-body">
                        <div class="d-flex align-items-center mb-3">
                            <div class="author-avatar me-3">
                                <i class="fas fa-user-circle fa-2x text-muted"></i>
                            </div>
                            <div>
                                <h5 class="card-title mb-0">{{ article.author.get_full_name|default:article.author.username }}</h5>
                                <p class="text-muted mb-0">News Contributor</p>
                            </div>
                        </div>
                        <p class="card-text text-muted">
                            {{ article.author.get_full_name|default:article.author.username }} is a contributor to Roorkee360, bringing you the latest news and stories from our community.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </article>


    <!-- Related Articles -->
    {% if related_articles %}
        <section class="related-articles py-5 bg-light">
            <div class="container">
                <div class="row mb-4">
                    <div class="col-12">
                        <h3 class="section-title">Related Articles</h3>
                        <p class="text-muted">More stories from {{ article.category.display_name }}</p>
                    </div>
                </div>
                
                <div class="row">
                    {% for related_article in related_articles %}
                    <div class="col-lg-4 col-md-6 mb-4">
                        <div class="card article-card h-100 border-0 shadow-sm">
                            {% if related_article.featured_image %}
                            <img src="{{ related_article.featured_image.url }}" class="card-img-top" alt="{{ related_article.featured_image_alt|default:related_article.title }}" style="height: 200px; object-fit: cover;">
                            {% else %}
                            <div class="card-img-top bg-secondary d-flex align-items-center justify-content-center" style="height: 200px;">
                                <i class="fas fa-newspaper fa-2x text-white-50"></i>
                            </div>
                            {% endif %}
                            <div class="card-body">
                                <span class="badge bg-primary mb-2">{{ related_article.category.display_name }}</span>
                                <h4 class="h5 card-title">
                                    <a href="{{ related_article.get_absolute_url }}" class="text-decoration-none text-dark">{{ related_article.title }}</a>
                                </h4>
                                <p class="card-text text-muted">{{ related_article.excerpt|default:related_article.subtitle|truncatewords:15 }}</p>
                            </div>
                            <div class="card-footer bg-transparent border-0 pt-0">
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="text-muted">{{ related_article.published_at|date:"M d, Y" }}</small>
                                    <a href="{{ related_article.get_absolute_url }}" class="btn btn-sm btn-outline-primary">Read More</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </section>
    {% endif %}

    {% comment %} 
    <div class="alert alert-info">
        <h4>🔍 Debug Information:</h4>
        <ul>
            <li>Article: {{ article.title }}</li>
            <li>Comments Count: {{ comments_count }}</li>
            <li>Form exists: {{ comment_form|yesno:"YES,NO" }}</li>
            <li>POST request: {{ request.method }}</li>
            <li>Messages: {{ messages|length }}</li>
        </ul>
    </div> 
    {% endcomment %}

    {% comment %}  Comments Section  {% endcomment %}
        <section id="comments" class="comments-section py-5">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="card border-0 shadow-sm">
                            <div class="card-body">
                                <h3 class="card-title mb-4">
                                    <i class="fas fa-comments me-2 text-primary"></i>
                                    Comments
                                    <span class="badge bg-primary ms-2">{{ comments_count }}</span>
                                </h3>
                                
                                <!-- Success/Error Messages -->
                                {% if messages %}
                                <div class="alerts-container mb-4">
                                    {% for message in messages %}
                                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                                        <i class="fas fa-{% if message.tags == 'success' %}check-circle{% elif message.tags == 'error' %}exclamation-circle{% else %}info-circle{% endif %} me-2"></i>
                                        {{ message }}
                                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                    </div>
                                    {% endfor %}
                                </div>
                                {% endif %}
                                
                                <!-- Comments List -->
                                {% if comments %}
                                <div class="comments-list mb-5">
                                    {% for comment in comments %}
                                    <div class="comment-item mb-4 pb-4 {% if not forloop.last %}border-bottom{% endif %}">
                                        <div class="d-flex align-items-start">
                                            <div class="comment-avatar me-3">
                                                <div class="avatar-circle">
                                                    <i class="fas fa-user"></i>
                                                </div>
                                            </div>
                                            <div class="comment-content flex-grow-1">
                                                <div class="d-flex justify-content-between align-items-start mb-2">
                                                    <div>
                                                        <h6 class="comment-author mb-1">{{ comment.name }}</h6>
                                                        <small class="text-muted">
                                                            <i class="far fa-clock me-1"></i>
                                                            {{ comment.created_at|date:"F j, Y \\a\\t g:i A" }}
                                                        </small>
                                                    </div>
                                                </div>
                                                <p class="comment-text mb-0">{{ comment.content|linebreaks }}</p>
                                            </div>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                                {% else %}
                                <div class="text-center py-4 mb-4">
                                    <i class="fas fa-comment-slash fa-3x text-muted mb-3"></i>
                                    <p class="text-muted">No comments yet. Be the first to share your thoughts!</p>
                                </div>
                                {% endif %}
                                
                                <!-- Comment Form -->
                                <div class="comment-form" id="comment-form">
                                    <h5 class="mb-3">
                                        <i class="fas fa-edit me-2"></i>
                                        Leave a Comment
                                    </h5>
                                    
                                    <form method="POST" action="{% url 'news:article_detail' article.slug %}#comments" novalidate>
                                        {% csrf_token %}
                                        
                                        <!-- Form Errors Display -->
                                        {% if comment_form.non_field_errors %}
                                        <div class="alert alert-danger" role="alert">
                                            {{ comment_form.non_field_errors }}
                                        </div>
                                        {% endif %}
                                        
                                        <div class="row">
                                            <!-- Name Field -->
                                            <div class="col-md-6 mb-3">
                                                <label for="{{ comment_form.name.id_for_label }}" class="form-label">
                                                    {{ comment_form.name.label }}
                                                </label>
                                                {{ comment_form.name }}
                                                {% if comment_form.name.errors %}
                                                <div class="invalid-feedback d-block">
                                                    {{ comment_form.name.errors.0 }}
                                                </div>
                                                {% endif %}
                                            </div>
                                            
                                            <!-- Email Field -->
                                            <div class="col-md-6 mb-3">
                                                <label for="{{ comment_form.email.id_for_label }}" class="form-label">
                                                    {{ comment_form.email.label }}
                                                </label>
                                                {{ comment_form.email }}
                                                {% if comment_form.email.errors %}
                                                <div class="invalid-feedback d-block">
                                                    {{ comment_form.email.errors.0 }}
                                                </div>
                                                {% endif %}
                                                <small class="form-text text-muted">
                                                    Your email will not be published
                                                </small>
                                            </div>
                                        </div>
                                        
                                        <!-- Comment Content Field -->
                                        <div class="mb-3">
                                            <label for="{{ comment_form.content.id_for_label }}" class="form-label">
                                                {{ comment_form.content.label }}
                                            </label>
                                            {{ comment_form.content }}
                                            {% if comment_form.content.errors %}
                                            <div class="invalid-feedback d-block">
                                                {{ comment_form.content.errors.0 }}
                                            </div>
                                            {% endif %}
                                            <small class="form-text text-muted">
                                                Maximum 1000 characters
                                            </small>
                                        </div>
                                        
                                        <!-- Submit Button -->
                                        <div class="d-flex justify-content-between align-items-center">
                                            <button type="submit" class="btn btn-primary btn-lg" id="submitCommentBtn">
                                                <i class="fas fa-paper-plane me-2"></i>
                                                Post Comment
                                            </button>
                                            <small class="text-muted">
                                                <i class="fas fa-shield-alt me-1"></i>
                                                Comments are moderated
                                            </small>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    {% endblock %}


{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        console.log('🚀 Comment functionality loaded');
        
        // ========== Calculate Reading Time ==========
        function calculateReadingTime() {
            const contentElement = document.querySelector('.article-content');
            if (contentElement) {
                const text = contentElement.textContent || contentElement.innerText;
                const wordCount = text.trim().split(/\s+/).length;
                const readingTimeMinutes = Math.ceil(wordCount / 200);
                const readingTimeEl = document.getElementById('reading-time');
                if (readingTimeEl) {
                    readingTimeEl.textContent = `${readingTimeMinutes} min read`;
                }
            }
        }
        
        calculateReadingTime();

        // ========== Social Sharing ==========
        document.querySelectorAll('.share-btn').forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                const platform = this.dataset.platform;
                const url = encodeURIComponent(this.dataset.url);
                const title = encodeURIComponent(this.dataset.title);
                
                let shareUrl;
                switch(platform) {
                    case 'facebook':
                        shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${url}`;
                        break;
                    case 'twitter':
                        shareUrl = `https://twitter.com/intent/tweet?text=${title}&url=${url}`;
                        break;
                    case 'whatsapp':
                        shareUrl = `https://wa.me/?text=${title} ${url}`;
                        break;
                }
                
                if (shareUrl) {
                    window.open(shareUrl, '_blank', 'width=600,height=400');
                }
            });
        });

        // ========== Copy Link ==========
        const copyLinkBtn = document.querySelector('.copy-link-btn');
        if (copyLinkBtn) {
            copyLinkBtn.addEventListener('click', function(e) {
                e.preventDefault();
                const url = this.dataset.url;
                
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(url).then(() => {
                        const originalText = this.innerHTML;
                        this.innerHTML = '<i class="fas fa-check me-2"></i>Copied!';
                        this.classList.add('btn-success');
                        this.classList.remove('btn-outline-dark');
                        
                        setTimeout(() => {
                            this.innerHTML = originalText;
                            this.classList.remove('btn-success');
                            this.classList.add('btn-outline-dark');
                        }, 2000);
                    }).catch(err => {
                        console.error('Copy failed:', err);
                        alert('Failed to copy link');
                    });
                } else {
                    // Fallback
                    const textArea = document.createElement('textarea');
                    textArea.value = url;
                    textArea.style.position = 'fixed';
                    textArea.style.opacity = '0';
                    document.body.appendChild(textArea);
                    textArea.select();
                    try {
                        document.execCommand('copy');
                        alert('Link copied to clipboard!');
                    } catch (err) {
                        alert('Failed to copy link');
                    }
                    document.body.removeChild(textArea);
                }
            });
        }

        // ========== COMMENT FORM HANDLING (MAIN FIX) ==========
        const commentForm = document.querySelector('.comment-form form');
        const submitBtn = document.getElementById('submitCommentBtn');
        
        if (commentForm) {
            console.log('✅ Comment form found');
            
            // Character counter
            const contentField = commentForm.querySelector('textarea[name="content"]');
            if (contentField) {
                const charCounterDiv = document.createElement('div');
                charCounterDiv.className = 'char-counter text-end mt-1';
                contentField.parentNode.appendChild(charCounterDiv);
                
                const updateCharCounter = () => {
                    const length = contentField.value.length;
                    const remaining = 1000 - length;
                    charCounterDiv.innerHTML = `<small class="text-muted">${remaining} characters remaining</small>`;
                    
                    if (remaining < 100) {
                        charCounterDiv.querySelector('small').classList.add('text-danger');
                        charCounterDiv.querySelector('small').classList.remove('text-muted');
                    } else {
                        charCounterDiv.querySelector('small').classList.remove('text-danger');
                        charCounterDiv.querySelector('small').classList.add('text-muted');
                    }
                };
                
                contentField.addEventListener('input', updateCharCounter);
                updateCharCounter();
            }
            
            // Form submission
            commentForm.addEventListener('submit', function(e) {
                console.log('📝 Form submit triggered');
                
                // Get form values
                const nameField = commentForm.querySelector('input[name="name"]');
                const emailField = commentForm.querySelector('input[name="email"]');
                const contentField = commentForm.querySelector('textarea[name="content"]');
                
                // Clear previous errors
                commentForm.querySelectorAll('.is-invalid').forEach(el => {
                    el.classList.remove('is-invalid');
                });
                commentForm.querySelectorAll('.invalid-feedback').forEach(el => {
                    if (!el.classList.contains('d-block')) {
                        el.remove();
                    }
                });
                
                let hasError = false;
                
                // Client-side validation
                if (!nameField || !nameField.value.trim()) {
                    showFieldError(nameField, 'Name is required');
                    hasError = true;
                } else if (nameField.value.trim().length < 2) {
                    showFieldError(nameField, 'Name must be at least 2 characters');
                    hasError = true;
                }
                
                if (!emailField || !emailField.value.trim()) {
                    showFieldError(emailField, 'Email is required');
                    hasError = true;
                } else if (!isValidEmail(emailField.value.trim())) {
                    showFieldError(emailField, 'Please enter a valid email');
                    hasError = true;
                }
                
                if (!contentField || !contentField.value.trim()) {
                    showFieldError(contentField, 'Comment is required');
                    hasError = true;
                } else if (contentField.value.trim().length < 10) {
                    showFieldError(contentField, 'Comment must be at least 10 characters');
                    hasError = true;
                }
                
                if (hasError) {
                    e.preventDefault();
                    console.log('❌ Validation failed');
                    
                    // Show error notification
                    showNotification('Please fill in all fields correctly', 'danger');
                    return false;
                }
                
                console.log('✅ Validation passed, submitting form...');
                
                // Show loading state
                if (submitBtn) {
                    submitBtn.disabled = true;
                    submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Posting...';
                }
                
                // Let the form submit naturally (don't prevent default)
                console.log('🚀 Form submitting to server...');
            });
        } else {
            console.warn('⚠️ Comment form not found');
        }
        
        // Helper function to show field errors
        function showFieldError(field, message) {
            if (!field) return;
            
            field.classList.add('is-invalid');
            
            // Remove existing error message if any
            const existingError = field.parentNode.querySelector('.invalid-feedback.custom-error');
            if (existingError) {
                existingError.remove();
            }
            
            // Add new error message
            const errorDiv = document.createElement('div');
            errorDiv.className = 'invalid-feedback custom-error d-block';
            errorDiv.textContent = message;
            field.parentNode.appendChild(errorDiv);
        }
        
        // Email validation helper
        function isValidEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }
        
        // Notification function
        function showNotification(message, type = 'info') {
            // Remove existing notifications
            document.querySelectorAll('.floating-notification').forEach(n => n.remove());
            
            const notification = document.createElement('div');
            notification.className = `alert alert-${type} alert-dismissible fade show floating-notification`;
            notification.style.cssText = 'position: fixed; top: 80px; right: 20px; z-index: 9999; min-width: 300px; animation: slideInRight 0.3s ease;';
            notification.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.body.appendChild(notification);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (notification && notification.parentNode) {
                    notification.classList.remove('show');
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.remove();
                        }
                    }, 300);
                }
            }, 5000);
        }

        // ========== Smooth Scroll to Comments ==========
        if (window.location.hash === '#comments') {
            setTimeout(() => {
                const commentsSection = document.getElementById('comments');
                if (commentsSection) {
                    commentsSection.scrollIntoView({ 
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            }, 100);
        }

        // ========== Reading Progress Bar ==========
        const readingProgress = document.createElement('div');
        readingProgress.className = 'reading-progress';
        readingProgress.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 0%;
            height: 3px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            z-index: 1000;
            transition: width 0.2s ease;
        `;
        document.body.appendChild(readingProgress);

        window.addEventListener('scroll', function() {
            const windowHeight = window.innerHeight;
            const documentHeight = document.documentElement.scrollHeight;
            const scrollTop = window.pageYOffset;
            const scrollPercent = (scrollTop / (documentHeight - windowHeight)) * 100;
            
            readingProgress.style.width = Math.min(scrollPercent, 100) + '%';
        });
        
        // ========== Auto-dismiss alerts ==========
        setTimeout(() => {
            const alerts = document.querySelectorAll('.alerts-container .alert');
            alerts.forEach(alert => {
                const bsAlert = new bootstrap.Alert(alert);
                bsAlert.close();
            });
        }, 5000);
    });

    // Add animation CSS
    const style = document.createElement('style');
    style.textContent = `
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .char-counter {
            transition: all 0.3s ease;
        }
        
        .is-invalid {
            border-color: #dc3545 !important;
        }
        
        .invalid-feedback.custom-error {
            display: block;
            color: #dc3545;
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }
    `;
    document.head.appendChild(style);

    console.log('✅ Article detail page JavaScript loaded successfully');
</script>
{% endblock %}